<SQLFunctionSpec
	xmlns="bb_appfx_sqlfunction"
	xmlns:common="bb_appfx_commontypes" 
	ID="10b9ba83-071c-49da-a33c-d68e4a327dba"
	Name="USR_UFN_SPONSORSHIP_GETACTIVECHILDSPONSORSHIPSFORSPONSOR"
	Description="Find the number of active child sponsorships for a constituent. Prospect sponsorships are not included."
	Author="Cary Mayeda"
	DBFunctionName="USR_UFN_SPONSORSHIP_GETACTIVECHILDSPONSORSHIPSFORSPONSOR" >
	<!-- 
	Remarks:    Copied UFN_SPONSORSHIP_GETACTIVESPONSORSHIPSFORSPONSOR and added check for only children.

	History:
	Date            Modified By     Comments
	22-Sep-2012		CMayeda			Initial Version
	-->

	<CreateFunctionSQL>
		<![CDATA[
create function dbo.USR_UFN_SPONSORSHIP_GETACTIVECHILDSPONSORSHIPSFORSPONSOR
(
  @SPONSORID uniqueidentifier
)
returns int
with execute as caller
as begin

	declare @COUNT int =0;
  
	select @COUNT = COUNT(*) 
      from dbo.SPONSORSHIP 
     where CONSTITUENTID=@SPONSORID 
       and STATUSCODE=1  -- Active
       and SPONSORSHIPOPPORTUNITYID in (select ID from dbo.SPONSORSHIPOPPORTUNITYCHILD) -- Only children

 return @COUNT
end
		
		]]>
	</CreateFunctionSQL>

</SQLFunctionSpec>
